
# Requirements for vTasks

## 1. Overview

The vTasks application is a web-based tool designed for lightweight task management and note-taking. It allows users to create, view, edit, complete, archive (notes), snooze, and delete tasks and notes. The application features a **single, exclusive dark theme**. Key functionalities include drag-and-drop reordering for active items, inline editing, modal dialogs, data filtering, data import/export, and persistence of all data locally in the user's browser via `localStorage`.

## 2. Core Data Structures

### 2.1. `Entry` Interface (`src/types.ts`)
The central data model for both tasks and notes.

```typescript
export enum EntryType {
  Task = 'TASK',
  Note = 'NOTE',
}

export enum PriorityLevel {
  Critical = 'CRITICAL',
  High = 'HIGH',
  Normal = 'NORMAL',
  Low = 'LOW',
}

export interface Entry {
  id: string; // Unique identifier, generated by crypto.randomUUID()
  title: string; // Required, the main title of the task or note
  details?: string; // Optional additional details or content
  type: EntryType; // Specifies if the entry is a TASK or a NOTE
  createdAt: string; // ISO Date string, timestamp of creation
  isCompleted: boolean; // For tasks: true if completed, false otherwise. Default: false.
  completedAt?: string; // ISO Date string, timestamp of completion (for tasks)
  completionNotes?: string; // Optional notes added when a task is completed
  dueDate?: string; // Optional ISO Date string (YYYY-MM-DD format from date input) for task due dates
  contact?: string; // Optional contact information (name, email, phone)
  url?: string; // Optional URL associated with the entry
  isArchived?: boolean; // For notes: true if archived, false otherwise. Default: false.
  archivedAt?: string; // ISO Date string, timestamp of archiving (for notes)
  project?: string; // Optional project name
  priority?: PriorityLevel; // Optional priority level. Default: Normal.
  snoozedUntil?: string; // Optional ISO Date string (full date-time), if item is snoozed. This is cleared when an item auto-unsnoozes or is manually unsnoozed.
  wokeUpAt?: string; // Optional ISO Date string, set when item automatically unsnoozes or is manually unsnoozed from a snoozed state. Cleared on subsequent interaction (e.g., card click), re-snooze, completion, or archiving.
}
```

### 2.2. `TabView` Enum (`src/types.ts`)
Used internally to manage which primary list view is active. Other views like completed, archived, and snoozed are handled by a separate `viewMode` state in `App.tsx`.

```typescript
export enum TabView {
  ActiveTasks = 'ACTIVE_TASKS',
  Notes = 'NOTES',
}
```

### 2.3. `ActiveFilters` Interface (`src/types.ts`)
Defines the structure for active filter criteria.
```typescript
export interface ActiveFilters {
  project?: string;
  priority?: PriorityLevel;
}
```

## 3. Styling & Theme

*   **Theme**: **Single, exclusive dark theme.**
*   **Color Palette**: Defined via CSS custom variables in `index.html`. Priority colors: Critical (Red), High (Yellow), Low (Sky Blue). "Woke Up" status color: Emerald green.
*   **Typography**: 'Inter'.
*   **Layout**: Responsive.
*   **Framework**: Tailwind CSS. Custom CSS for theme, scrollbars.

## 4. Main Application Layout & Views (`src/App.tsx`)

### 4.1. AppBar (`src/components/AppBar.tsx`)
*   Fixed position, `4rem` height. Title: "vTasks".

### 4.2. Input Form (`src/components/InputForm.tsx`)
*   Persistent. Type Selection ("Task", "Note"). Title Input & "Add Details" toggle for Options Panel (Details, Project, Due Date, Priority, Contact, URL). "Add Task/Note" button.

### 4.3. Main Content Area
Managed by `viewMode` state (`'main'`, `'completed'`, `'archived'`, `'snoozed'`).

*   **Main View (`viewMode === 'main'`)**:
    *   **Tabs & Filters**: "Active Tasks", "Notes" tabs with counts. Filter button for Project/Priority dropdown.
    *   **Tab Content**: `ActiveTaskList.tsx` or `NoteList.tsx`.
    *   **Navigation Buttons**: "View Snoozed Items", "View Completed Tasks", "View Archived Notes".
*   **Snoozed Items View (`viewMode === 'snoozed'`)**: Lists items with future `snoozedUntil`.
*   **Completed Tasks View (`viewMode === 'completed'`)**: Grouped by completion week.
*   **Archived Notes View (`viewMode === 'archived'`)**: Sorted by `archivedAt`.

## 5. Entry Item (`src/components/EntryItem.tsx`)

Displays a single task or note card.

### 5.1. General Display & Interaction
*   Appearance: Rounded, shadow, priority border.
*   Click Action: Opens `DetailModal`. If the item has `wokeUpAt` set (and is not actively snoozed), this interaction also clears `wokeUpAt`. Drag-and-Drop for active items.

### 5.2. Content (Non-Editing State)
*   Title, Task Checkbox, Project & Contact.
*   **Dates**: Due Date, "Snoozed Until:" (if `snoozedUntil` is future), "Woke up:" (if `wokeUpAt` is set and not yet cleared by interaction, distinct emerald color). Completed/Archived At dates.

### 5.3. Action Icons (Top-Right, conditional)
*   URL, Edit.
*   **Activate Icon (Play style)**: For actively snoozed items (`isCurrentlySnoozed` is true). Clicking it activates the item, clears `snoozedUntil`, and sets `wokeUpAt`.
*   **Snooze Icon (Clock style)**: For active items (including those with `wokeUpAt` that has not been cleared, but not actively snoozed). Opens `SnoozeModal`. Hidden if `isCurrentlySnoozed`.
*   Archive, Delete.

### 5.4. Inline Editing Mode
*   Inputs for Title, Details, Project, Due Date (clearable), Priority, Contact, URL.
*   Snooze Date/Time inputs (date clearable). Saving clears `wokeUpAt` if re-snoozing.

## 6. Modals

### 6.1. Detail Modal (`DetailModal.tsx`)
*   Header: Title, Action Icons (Edit, Snooze/Activate, Archive/Unarchive, Delete, Close).
    *   **Activate Icon (Play style)**: Shown only if item is *currently snoozed*. Action: Activates item, clears `snoozedUntil`, sets `wokeUpAt`.
    *   **Snooze Icon (Clock style)**: Shown if item is active and not currently snoozed (includes items that have woken up). Action: Opens `SnoozeModal`.
*   Body: Scrollable, displays all entry fields. "Snoozed Until:" and "Woke up:" (if applicable) displayed with distinct styles.
*   Footer: Task completion button.

### 6.2. Other Modals
(ConfirmDelete, CompletionNotes, ConfirmArchive, ExportOptions, ImportData, SnoozeModal - largely as before).
*   **SnoozeModal**: Used for initial snoozing and re-snoozing woken items. Snoozing sets `snoozedUntil` and clears `wokeUpAt`.

## 7. State Management (`src/App.tsx` & `src/hooks/useLocalStorage.ts`)

*   **`entries: Entry[]`**: Main data, `localStorage` key `'task-notes-entries-v3'`.
*   **Periodic Unsnooze Check**: `useEffect` checks snoozed items. If item auto-unsnoozes:
    *   Sets `wokeUpAt`, explicitly clears `snoozedUntil`.
*   **Setting/Clearing `wokeUpAt`**:
    *   `wokeUpAt` is SET when an item auto-unsnoozes or is manually unsnoozed (activated) from an actively snoozed state.
    *   `wokeUpAt` is CLEARED if the item is subsequently interacted with (e.g., card click if not actively snoozed), if it's re-snoozed, if its snooze settings are edited to a new future time, if it's completed (task), or archived (note).

## 8. Utility Functions (`src/utils/dateUtils.ts`)

Standard date formatting. `formatDate` used for Snoozed Until and Woke Up At display.

## 9. Data Import/Export (`src/App.tsx`)

JSON/CSV export includes `wokeUpAt`. Import handles this field.

## 10. Key User Workflows

*   **Automatic Unsnooze**: Item becomes active, `snoozedUntil` is cleared, `wokeUpAt` is set. Item can be snoozed again. Interacting with the card (e.g., clicking it) will clear the `wokeUpAt` status.
*   **Manual Unsnooze (Activate Snoozed Item)**: Clicking the "Activate" icon on a snoozed item makes it active, `snoozedUntil` is cleared, `wokeUpAt` is set to the current time. Item can be snoozed again. Interacting with the card subsequently will clear `wokeUpAt`.
*   **Re-Snooze Woken Item**: Woken item's card shows Snooze icon. Clicking opens `SnoozeModal`. Snoozing sets `snoozedUntil` and clears `wokeUpAt`.
*   **Card Click on Woken Item**: If an item has `wokeUpAt` set and is not actively snoozed, clicking its card (e.g., to open the detail modal) clears the `wokeUpAt` field.

## 11. Build and Deployment

Standard Vite build.

## 12. Accessibility

ARIA attributes, keyboard navigation, focus, contrast.

## 13. Notifications
Desktop notifications have been removed from the application.