
# Requirements for vTasks

## 1. Overview

The vTasks application is a web-based tool designed for lightweight task management and note-taking. It allows users to create, view, edit, complete, archive (notes), snooze, and delete tasks and notes. The application features a **single, exclusive dark theme**. Key functionalities include drag-and-drop reordering for active items, inline editing, modal dialogs, data filtering, data import/export, persistence of all data locally in the user's browser via `localStorage`, desktop notifications for items coming off snooze, and a visual flash animation for newly woken items.

## 2. Core Data Structures

### 2.1. `Entry` Interface (`src/types.ts`)
The central data model for both tasks and notes.

```typescript
export enum EntryType {
  Task = 'TASK',
  Note = 'NOTE',
}

export enum PriorityLevel {
  Critical = 'CRITICAL',
  High = 'HIGH',
  Normal = 'NORMAL',
  Low = 'LOW',
}

export interface Entry {
  id: string; // Unique identifier, generated by crypto.randomUUID()
  title: string; // Required, the main title of the task or note
  details?: string; // Optional additional details or content
  type: EntryType; // Specifies if the entry is a TASK or a NOTE
  createdAt: string; // ISO Date string, timestamp of creation
  isCompleted: boolean; // For tasks: true if completed, false otherwise. Default: false.
  completedAt?: string; // ISO Date string, timestamp of completion (for tasks)
  completionNotes?: string; // Optional notes added when a task is completed
  dueDate?: string; // Optional ISO Date string (YYYY-MM-DD format from date input) for task due dates
  contact?: string; // Optional contact information (name, email, phone)
  url?: string; // Optional URL associated with the entry
  isArchived?: boolean; // For notes: true if archived, false otherwise. Default: false.
  archivedAt?: string; // ISO Date string, timestamp of archiving (for notes)
  project?: string; // Optional project name
  priority?: PriorityLevel; // Optional priority level. Default: Normal.
  snoozedUntil?: string; // Optional ISO Date string (full date-time), if item is snoozed. This is cleared when an item auto-unsnoozes.
  wokeUpAt?: string; // Optional ISO Date string, when item automatically unsnoozed.
}
```

### 2.2. `TabView` Enum (`src/types.ts`)
Used internally to manage which primary list view is active. Other views like completed, archived, and snoozed are handled by a separate `viewMode` state in `App.tsx`.

```typescript
export enum TabView {
  ActiveTasks = 'ACTIVE_TASKS',
  Notes = 'NOTES',
}
```

### 2.3. `ActiveFilters` Interface (`src/types.ts`)
Defines the structure for active filter criteria.
```typescript
export interface ActiveFilters {
  project?: string;
  priority?: PriorityLevel;
}
```

## 3. Styling & Theme

*   **Theme**: **Single, exclusive dark theme.**
*   **Color Palette**: Defined via CSS custom variables in `index.html`. Priority colors: Critical (Red), High (Yellow), Low (Sky Blue). "Woke Up" status color: Emerald green.
*   **Typography**: 'Inter'.
*   **Layout**: Responsive.
*   **Framework**: Tailwind CSS. Custom CSS for theme, scrollbars, animations.
*   **Animations**:
    *   `animate-wakeup-flash`: A CSS class using keyframes (`@keyframes wakeupFlash`) to briefly change the background color of an `EntryItem` card when it auto-unsnoozes.

## 4. Main Application Layout & Views (`src/App.tsx`)

### 4.1. AppBar (`src/components/AppBar.tsx`)
*   Fixed position, `4rem` height. Title: "vTasks".

### 4.2. Input Form (`src/components/InputForm.tsx`)
*   Persistent. Type Selection ("Task", "Note"). Title Input & "Add Details" toggle for Options Panel (Details, Project, Due Date, Priority, Contact, URL). "Add Task/Note" button.

### 4.3. Main Content Area
Managed by `viewMode` state (`'main'`, `'completed'`, `'archived'`, `'snoozed'`).

*   **Main View (`viewMode === 'main'`)**:
    *   **Tabs & Filters**: "Active Tasks", "Notes" tabs with counts. Filter button for Project/Priority dropdown.
    *   **Tab Content**: `ActiveTaskList.tsx` or `NoteList.tsx`. Items that auto-unsnooze will trigger a brief background flash animation on their card.
    *   **Navigation Buttons**: "View Snoozed Items", "View Completed Tasks", "View Archived Notes".
*   **Snoozed Items View (`viewMode === 'snoozed'`)**: Lists items with future `snoozedUntil`.
*   **Completed Tasks View (`viewMode === 'completed'`)**: Grouped by completion week.
*   **Archived Notes View (`viewMode === 'archived'`)**: Sorted by `archivedAt`.

### 4.4. Footer
*   "Import Data", "Export All Data" buttons. Copyright.

## 5. Entry Item (`src/components/EntryItem.tsx`)

Displays a single task or note card.

### 5.1. General Display & Interaction
*   Appearance: Rounded, shadow, priority border. Card background briefly animates (`animate-wakeup-flash`) if `animateNow` prop is true (triggered by auto-unsnooze).
*   Click Action: Opens `DetailModal`. Drag-and-Drop for active items.

### 5.2. Content (Non-Editing State)
*   Title, Task Checkbox, Project & Contact.
*   **Dates**: Due Date, Snoozed Date (if `snoozedUntil` is future), Woke Up Date (if `wokeUpAt` is set, distinct emerald color). Completed/Archived At dates.

### 5.3. Action Icons (Top-Right, conditional)
*   URL, Edit.
*   **Unsnooze Icon**: For snoozed items. Clears `snoozedUntil` and `wokeUpAt`.
*   **Snooze Icon**: For active items (including those with `wokeUpAt`). Opens `SnoozeModal`. Hidden if `isCurrentlySnoozed`.
*   Archive, Delete.

### 5.4. Inline Editing Mode
*   Inputs for Title, Details, Project, Due Date (clearable), Priority, Contact, URL.
*   Snooze Date/Time inputs (date clearable). Saving clears `wokeUpAt` if re-snoozing.

## 6. Modals

(Detail, ConfirmDelete, CompletionNotes, ConfirmArchive, ExportOptions, ImportData, SnoozeModal - largely as before, but SnoozeModal usage is now also for woken items).

## 7. State Management (`src/App.tsx` & `src/hooks/useLocalStorage.ts`)

*   **`entries: Entry[]`**: Main data, `localStorage` key `'task-notes-entries-v3'`.
*   **`animateWakeUpForIds: Set<string>`**: Stores IDs of items that just woke up, to trigger animation. IDs are removed after a short timeout.
*   **Periodic Unsnooze Check & Notifications**: `useEffect` checks snoozed items. If unsnoozes:
    *   Sets `wokeUpAt`, explicitly clears `snoozedUntil`.
    *   Adds item ID to `animateWakeUpForIds` for animation.
    *   Fires desktop notification (if permitted).
*   **Clearing `wokeUpAt`**: Cleared if item re-snoozed, manually unsnoozed, edited (snooze settings), completed (task), or archived (note).

## 8. Utility Functions (`src/utils/dateUtils.ts`)

Standard date formatting. `formatDate` used for Snoozed Until and Woke Up At display.

## 9. Data Import/Export (`src/App.tsx`)

JSON/CSV export includes `wokeUpAt`. Import handles this field.

## 10. Key User Workflows

*   **Automatic Unsnooze**: Item becomes active, `snoozedUntil` is cleared, `wokeUpAt` is set, card animates with a flash, desktop notification fires. Item can be snoozed again.
*   **Re-Snooze Woken Item**: Woken item's card shows Snooze icon. Clicking opens `SnoozeModal`. Snoozing sets `snoozedUntil` and clears `wokeUpAt`.
*   Other workflows account for new fields and `wokeUpAt` clearing/setting.

## 11. Build and Deployment

Standard Vite build.

## 12. Accessibility

ARIA attributes, keyboard navigation, focus, contrast. Animation is brief and purely visual feedback.

## 13. Notifications
Request permission on load. On auto-unsnooze, system notification if permitted.
