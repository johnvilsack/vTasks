# Requirements for vTasks

## 1. Overview

The vTasks application is a web-based tool designed for lightweight task management and note-taking. It allows users to create, view, edit, complete, archive (notes), and delete tasks and notes. The application features a **single, exclusive dark theme**. Key functionalities include drag-and-drop reordering for active items, inline editing capabilities, modal dialogs for detailed views, **delete confirmations**, **archive confirmations for notes**, and **adding completion notes for tasks (optional)**. All data is persisted locally in the user's browser via `localStorage`. The application is built using React and TypeScript, and deployed as a static site to GitHub Pages.

## 2. Core Data Structures

### 2.1. `Entry` Interface (`src/types.ts`)
The central data model for both tasks and notes.

```typescript
export enum EntryType {
  Task = 'TASK',
  Note = 'NOTE',
}

export interface Entry {
  id: string; // Unique identifier, generated by crypto.randomUUID()
  title: string; // Required, the main title of the task or note
  details?: string; // Optional additional details or content
  type: EntryType; // Specifies if the entry is a TASK or a NOTE
  createdAt: string; // ISO Date string, timestamp of creation
  isCompleted: boolean; // For tasks: true if completed, false otherwise
  completedAt?: string; // ISO Date string, timestamp of completion (for tasks)
  completionNotes?: string; // Optional notes added when a task is completed
  dueDate?: string; // Optional ISO Date string (YYYY-MM-DD format from date input) for task due dates
  contact?: string; // Optional contact information (name, email, phone)
  url?: string; // Optional URL associated with the entry
  isArchived?: boolean; // For notes: true if archived, false otherwise
  archivedAt?: string; // ISO Date string, timestamp of archiving (for notes)
}
```

### 2.2. `TabView` Enum (`src/types.ts`)
Used internally to manage which primary list view is active or which secondary view (like completed tasks) is displayed.

```typescript
export enum TabView {
  ActiveTasks = 'ACTIVE_TASKS',
  Notes = 'NOTES',
  CompletedTasks = 'COMPLETED_TASKS', // Represents the view for completed tasks
  ArchivedNotes = 'ARCHIVED_NOTES',  // Represents the view for archived notes
}
```

## 3. Styling & Theme

*   **Theme**: **Single, exclusive dark theme. There is no light mode or theme toggle functionality.**
*   **Color Palette (Dark Theme - "Dark Purple/Magenta" inspired)**:
    *   **Main Background**: Very dark desaturated purple (e.g., `rgb(26 23 40)` defined as `--bg-color`).
    *   **AppBar Background**: Dark, slightly desaturated purple (e.g., `rgb(49 46 69)` defined as `--app-bar-bg-color`).
    *   **Card Backgrounds**: Dark purple, distinct from the main background (e.g., `rgb(36 32 55)` defined as `--card-bg-color`).
    *   **Primary Text**: Light lavender/gray (e.g., `rgb(235 232 245)` defined as `--text-primary`).
    *   **Secondary Text**: Medium lavender/gray (e.g., `rgb(188 182 213)` defined as `--text-secondary`).
    *   **Accent Color (Primary Actions)**: Bright Violet (e.g., `rgb(167 139 250)` defined as `--accent-color`).
    *   **Highlight Color (Secondary Actions/Highlights)**: Bright Magenta (e.g., `rgb(236 72 153)` defined as `--highlight-color`).
    *   **Borders/Dividers**: Subtle, dark shades (e.g., `rgb(59 55 80)` defined as `--border-color`).
    *   Input fields, buttons, and other elements use these variables for consistent theming.
    *   All color definitions are centralized in `index.html` using CSS custom variables.
*   **Typography**: Primary font is 'Inter', with fallbacks. Weights 400, 500, 600, 700 are used.
*   **Layout**: Responsive design catering to various screen sizes.
*   **Framework**: Tailwind CSS (v3 via CDN) is used for utility classes. Custom CSS is minimal and primarily for theme variables, scrollbars, and specific complex styles.
*   **Custom Styles**:
    *   Styled scrollbars for a consistent look.
    *   Visual cues for drag-and-drop: `grab`/`grabbing` cursors, opacity changes on dragged items, drop target indicators.
    *   Modal overlay with backdrop blur and centered modal content styling.

## 4. Main Application Layout & Views (`src/App.tsx`)

### 4.1. AppBar (`src/components/AppBar.tsx`)
*   Fixed position at the top of the viewport. Height is `4rem` (64px).
*   Displays the application title: "vTasks".
*   **Does NOT contain a theme toggle button.**

### 4.2. Input Form (`src/components/InputForm.tsx`)
*   Persistently displayed below the AppBar.
*   **Type Selection**: A segmented control (two buttons side-by-side) for "Task" and "Note" selection. The active type is visually highlighted.
*   **Title Input & Integrated "Add Details" Icon Button**:
    *   A primary text input field for the `Entry` title (required).
    *   Placeholder text dynamically updates based on the selected `EntryType` ("New task..." or "New note title...").
    *   **An icon button (plus/minus symbol) is integrated directly into the far right side of this title input field.** Clicking this icon toggles the visibility of the "Options Panel".
    *   **The icon button has a background style similar to standard secondary buttons (e.g., `bg-[rgb(var(--button-secondary-bg-color))]`) for better visual affordance.**
*   **Options Panel** (Toggled by the "Add Details" icon button, initially hidden):
    *   `Details`: A `textarea` for multi-line descriptions.
    *   `Due Date`: An `<input type="date">` field.
    *   `Contact`: A text input field.
    *   `URL (Optional)`: An `<input type="url">` field.
        *   **Auto-HTTPS**: If a user types a domain like `example.com` (without `http://` or `https://` but containing at least one dot) and the field loses focus or the form is submitted, `https://` is automatically prepended to the URL.
*   **Submission**:
    *   A full-width "Add Task" or "Add Note" button (label changes based on selected `EntryType`).
    *   Upon submission:
        *   A new `Entry` is created with a unique `id` (using `crypto.randomUUID()`) and current `createdAt` timestamp.
        *   The new entry is added to the beginning of the `entries` list.
        *   All input fields in the form (title, details, dueDate, contact, url) are cleared.
        *   **The "Options Panel" is hidden/minimized (`setShowOptions(false)`).**
        *   The view focuses on the tab corresponding to the added entry type.

### 4.3. Main Content Area
Managed by `viewMode` state in `src/App.tsx` (`'main'`, `'completed'`, `'archived'`).

*   **Main View (`viewMode === 'main'`)**:
    *   **Tabs (`src/components/Tabs.tsx`)**:
        *   Displays two tabs: "Active Tasks" and "Notes".
        *   Each tab indicates the count of items it contains.
        *   The currently active tab is visually distinct (e.g., different text color, underline).
    *   **Tab Content**:
        *   Displays `src/components/ActiveTaskList.tsx` if "Active Tasks" tab is selected.
        *   Displays `src/components/NoteList.tsx` if "Notes" tab is selected.
    *   **Navigation Buttons**:
        *   "View Completed Tasks" button: Appears below the tabbed content area if `completedTasks.length > 0`. Navigates to the `'completed'` view.
        *   "View Archived Notes" button: Appears below the "View Completed Tasks" button (or tabbed content if no completed tasks) if `archivedNotes.length > 0`. Navigates to the `'archived'` view.
*   **Completed Tasks View (`viewMode === 'completed'`)**:
    *   Renders `src/components/CompletedTaskList.tsx`.
    *   Displays a heading "Completed Tasks".
    *   Includes a "← Back" button to return to the `main` view.
    *   Completed tasks are grouped by the week they were completed (e.g., "Week 21 (Jul 15 - Jul 21), 2024").
    *   Groups are sorted with the most recent week first. Tasks within each group are sorted by `completedAt` timestamp (most recent first).
*   **Archived Notes View (`viewMode === 'archived'`)**:
    *   Renders `src/components/ArchivedNoteList.tsx`.
    *   Displays a heading "Archived Notes".
    *   Includes a "← Back" button to return to the `main` view.
    *   Archived notes are sorted by `archivedAt` timestamp (most recent first).

### 4.4. Footer
*   **Not sticky.** Appears at the bottom of the page content flow.
*   Contains an **"Export All Data" button**:
    *   **Opens an "Export Options" modal (`src/components/ExportOptionsModal.tsx`).**
    *   The modal offers choices to "Export as JSON" or "Export as CSV".
    *   Selecting an option downloads all `entries` in the chosen format (e.g., `vtasks-export-YYYYMMDD_HHMMSS.json` or `.csv`).
    *   Shows an alert (before opening the modal) if there is no data to export.
*   Displays a copyright notice: **"© 2025 John Vilsack"**.

## 5. Entry Item (`src/components/EntryItem.tsx`)

Displays a single task or note card.

### 5.1. General Display & Interaction
*   **Appearance**: Rounded corners, shadow, border. Visual style changes if completed, archived, or being edited. Generally compact.
*   **Click Action**: Clicking the main card area (excluding action buttons or active input fields) opens the `DetailModal` for that entry.
*   **Drag-and-Drop** (`allowActions === true`, i.e., in Active Tasks/Notes lists):
    *   Entire card is draggable.
    *   Cursor: `grab` on hover, `grabbing` during drag.
    *   Dragged Item: Opacity reduced (e.g., 0.6), slight scale transform, enhanced shadow.
    *   Drop Target: A top border indicator appears on potential drop targets when dragging over them.
    *   Reordering is constrained to items of the same type and status.
*   **Content (Non-Editing State)**:
    *   **Title**: Prominently displayed. For completed tasks, the title has a line-through.
    *   **Task Checkbox** (For tasks, if `allowActions === true`):
        *   Marks task complete/incomplete.
        *   **If checking (marking as complete): Opens the `CompletionNotesModal`.**
        *   If unchecking: Marks as incomplete, clears `completedAt` and `completionNotes`.
    *   **Due Date**: If present, not completed, and not archived, displayed at the bottom-right (e.g., "Due: Mon, Jul 15, 2024").
    *   **Created At Date**: For completed tasks in the "Completed Tasks" view (where `allowActions === false`), displayed below the title (e.g., "Created: Jul 15, 2024").
    *   **Archived At Date**: For archived notes in the "Archived Notes" view (where `allowActions === false`), displayed below the title (e.g., "Archived: Jul 15, 2024").
    *   **Hidden from Card**: `Details`, `Contact`, `URL` are not directly visible on the card in list views.

### 5.2. Action Icons (Top-Right Corner, if `allowActions === true`)
*   **Edit Icon (Pencil)**: For active (non-completed, non-archived) tasks and notes. Toggles inline editing mode for the card.
*   **Archive Icon (Archive Box)**: For active notes. **Opens `ConfirmArchiveModal`.**
*   **Delete Icon (Trash Can)**: For active tasks and notes. **Opens `ConfirmDeleteModal`.**

### 5.3. Inline Editing Mode
*   Triggered by the "Edit" icon.
*   Card content is replaced by input fields for: **`Title` (text input), `Details` (textarea), `Due Date` (date input), `Contact` (text input), and `URL` (text input).**
*   "Save" and "Cancel" buttons are shown.
    *   "Save": Updates the entry with all modified fields, exits editing mode. Title is required.
    *   "Cancel": Discards changes, exits editing mode.

## 6. Modals

### 6.1. Detail Modal (`src/components/DetailModal.tsx`)
*   Opens on `EntryItem` card click.
*   **Layout**:
    *   Full-screen overlay with backdrop blur. Centered modal content.
    *   **Header**: Entry Title on the left.
    *   **Action Icons (Top-Right of Modal Content Area)**:
        *   **Edit Icon**: For active tasks/notes. Closes modal, then enables inline editing on the card.
        *   **Archive/Unarchive Icon**: For notes. **Opens `ConfirmArchiveModal`**.
        *   **Delete Icon**: Opens `ConfirmDeleteModal`.
        *   **Close Button (X icon)**.
    *   **Body (Scrollable)**: Displays "Label: Value" pairs for:
        *   Type, Details, Due Date, Contact, URL (clickable link), Created At.
        *   If task is completed: Completed At, **Completion Notes (if any)**.
        *   If note is archived: Archived At.
    *   **Footer (Conditional for Tasks)**:
        *   "Mark as Complete" / "Mark as Incomplete" button.
        *   **Marking complete opens `CompletionNotesModal`.**

### 6.2. Confirm Delete Modal (`src/components/ConfirmDeleteModal.tsx`)
*   Opens when any delete action is initiated (from `EntryItem` or `DetailModal`).
*   **Content**:
    *   Title: "Confirm Deletion".
    *   Message: "Are you sure you want to delete '[Entry Title]'? This action cannot be undone." (Item name is dynamic).
    *   Buttons: "Cancel", "Delete" (styled as a destructive action).

### 6.3. Completion Notes Modal (`src/components/CompletionNotesModal.tsx`)
*   Opens when a task is being marked as complete (from `EntryItem` checkbox or `DetailModal` button).
*   **Content**:
    *   Title: "Completion Notes for '[Task Title]'". (Task title is dynamic).
    *   Textarea for entering notes.
    *   Buttons: **"Skip & Complete"**, "Save Notes & Complete Task".
    *   Saving stores notes in the `completionNotes` field of the task and marks it complete.
    *   **"Skip & Complete" marks the task as complete without adding/modifying completion notes (sets `completionNotes` to empty/undefined).**

### 6.4. Confirm Archive Modal (`src/components/ConfirmArchiveModal.tsx`)
*   Opens when an archive/unarchive action is initiated for a note (from `EntryItem` or `DetailModal`).
*   **Content**:
    *   Title: "Confirm Archive" or "Confirm Unarchive".
    *   Message: "Are you sure you want to archive '[Note Title]'?" or "Are you sure you want to unarchive '[Note Title]'?". (Item name is dynamic).
    *   Buttons: "Cancel", "Archive"/"Unarchive" (styled as a primary action).

### 6.5. Export Options Modal (`src/components/ExportOptionsModal.tsx`)
*   Opens when the "Export All Data" button in the footer is clicked (and data exists).
*   **Content**:
    *   Title: "Export Data".
    *   Message: "Choose the format for your data export."
    *   Buttons: "Export as JSON", "Export as CSV", "Cancel".
    *   Each export button triggers the respective download and closes the modal.

## 7. State Management (`src/App.tsx` & `src/hooks/useLocalStorage.ts`)

*   **`entries: Entry[]`**: Main data array, persisted to `localStorage` (key: `'task-notes-entries-v3'`) via `useLocalStorage`.
*   **`activeTab: TabView`**: Current active tab in the main view.
*   **`editingNoteId: string | null`, `editingTaskId: string | null`**: ID of entry being edited inline.
*   **`draggedItemId: string | null`**: ID of item being dragged.
*   **`viewMode: 'main' | 'completed' | 'archived'`**: Controls the overall view.
*   **Modal States**:
    *   `isDetailModalOpen: boolean`, `selectedEntryForDetail: Entry | null`.
    *   `isDeleteConfirmOpen: boolean`, `itemToDelete: Entry | null`.
    *   `isCompletionNotesModalOpen: boolean`, `taskForCompletionNotes: Entry | null`.
    *   `isArchiveConfirmOpen: boolean`, `itemToArchive: Entry | null`.
    *   **`isExportOptionsModalOpen: boolean` (for choosing export format).**
*   State updates use React state setters, triggering re-renders.
*   `useMemo` for derived lists (activeTasks, notes, completed, archived) to optimize.
*   `useCallback` for event handlers passed to children.

## 8. Utility Functions (`src/utils/dateUtils.ts`)

*   `getWeekOfYear(dateString)`: Calculates `{ week: number, year: number }`.
*   `getWeekDates(weekNumber, year)`: Returns `{ start: Date, end: Date }` (Monday start).
*   `formatWeekDateRange(dateStringInput)`: e.g., "(Jul 15 - Jul 21)".
*   `formatDate(dateString?)`: e.g., "July 15, 2024, 10:30 AM".
*   `formatDueDate(dateString?)`: e.g., "Mon, Jul 15, 2024". Handles YYYY-MM-DD.
*   `formatDateShort(dateString?)`: e.g., "Jul 15, 2024".
*   `formatArchivedAtDate(dateString?)`: e.g., "Jul 15, 2024".

## 9. Technical Stack & File Structure

*   **React 19**: Functional Components, Hooks.
*   **ReactDOM**: For rendering.
*   **TypeScript**.
*   **Vite**: Build tool for development and production bundling.
*   **Node.js/npm**: For dependency management and running scripts.
*   **Tailwind CSS** (via CDN in `index.html`).
*   **Core Files & Directories**:
    *   `index.html`: (Project Root) Entry point, Tailwind CDN, CSS vars for **exclusive dark theme**. Vite injects built scripts here.
    *   `package.json`: (Project Root) Manages project dependencies (React, Vite, TypeScript) and defines `npm` scripts (`dev`, `build`, `lint`).
    *   `vite.config.ts`: (Project Root) Configuration for Vite, including the `base` path for GitHub Pages deployment.
    *   `tsconfig.json`: TypeScript compiler configuration.
    *   `src/`: Contains all application source code.
        *   `main.tsx`: React root rendering (entry point for Vite).
        *   `App.tsx`: Main application logic and layout for vTasks.
        *   `types.ts`: All TypeScript types and enums.
        *   `hooks/useLocalStorage.ts`: For `localStorage` persistence.
        *   `utils/dateUtils.ts`: Date utilities.
        *   `components/`: Directory for all React components (e.g., `AppBar.tsx`, `InputForm.tsx`, `EntryItem.tsx`, modals, etc.).
    *   `.github/workflows/deploy-gh-pages.yml`: GitHub Actions workflow for automated build and deployment to GitHub Pages.
    *   `metadata.json`: Application metadata.
    *   `README.md`: Project overview, setup, and deployment instructions for vTasks.

## 10. Key User Workflows

*   **Add Entry**: Use `InputForm`, toggle options with integrated icon, submit. **Options panel minimizes.**
*   **View Entries**: Navigate via tabs and "View Completed/Archived" buttons.
*   **Edit Entry**: Click edit icon on card for inline editing (**all fields: title, details, due date, contact, URL**). OR click card for Detail Modal, then edit icon from modal (closes modal, starts inline edit).
*   **Complete Task**: Click checkbox on card OR "Mark as Complete" in Detail Modal -> **`CompletionNotesModal` appears** -> enter notes (optional) or click "Skip & Complete" -> task completed.
*   **Uncomplete Task**: Click checkbox on card OR "Mark as Incomplete" in Detail Modal -> task uncompleted, completion notes cleared.
*   **Delete Entry**: Click delete icon on card OR in Detail Modal -> **`ConfirmDeleteModal` appears** -> confirm -> entry removed.
*   **Archive/Unarchive Note**: Click archive icon on card OR in Detail Modal -> **`ConfirmArchiveModal` appears** -> confirm -> toggles archive status.
*   **Reorder**: Drag-and-drop active tasks or notes.
*   **Export**: "Export All Data" button in footer -> **`ExportOptionsModal` appears** -> choose "Export as JSON" or "Export as CSV" -> data downloaded.

## 11. Build and Deployment

*   **Local Development**: Run `npm run dev` to start the Vite development server.
*   **Production Build**: Run `npm run build` to generate a static production build in the `dist/` directory.
*   **GitHub Pages Deployment**:
    *   Deployment is automated via a GitHub Actions workflow defined in `.github/workflows/deploy-gh-pages.yml`.
    *   The workflow triggers on pushes to the `main` branch.
    *   It builds the application using `npm run build` and deploys the contents of the `dist/` folder to GitHub Pages.
    *   The `base` path in `vite.config.ts` is crucial for correct asset loading on GitHub Pages (e.g., `base: '/vtasks/'` for `https://username.github.io/vtasks/`).
    *   Refer to `README.md` for GitHub Pages configuration in repository settings (Source: GitHub Actions).

## 12. Accessibility

*   Utilize semantic HTML5 elements.
*   Provide `aria-label`s for icon buttons and other non-descriptive interactive elements.
*   Use `role` attributes where appropriate (e.g., `tablist`, `tab`, `dialog`).
*   Ensure sufficient color contrast within the dark theme.
*   Maintain keyboard navigability for all interactive elements.
*   Implement clear focus indicators.